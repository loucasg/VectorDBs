<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qdrant Vector Database Explorer</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .collection-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .collection-card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background: #f9f9f9;
            cursor: pointer;
            transition: all 0.2s;
        }
        .collection-card:hover {
            background: #e8f4f8;
            border-color: #3498db;
        }
        .collection-card.selected {
            background: #e8f4f8;
            border-color: #3498db;
        }
        .collection-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .collection-info {
            font-size: 14px;
            color: #666;
        }
        .search-section {
            display: none;
        }
        .search-section.active {
            display: block;
        }
        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        .search-controls input, .search-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-controls button {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-controls button:hover {
            background: #2980b9;
        }
        .search-results {
            margin-top: 20px;
        }
        .result-item {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
            background: #f9f9f9;
        }
        .result-score {
            font-weight: bold;
            color: #27ae60;
            margin-bottom: 10px;
        }
        .result-payload {
            font-family: monospace;
            font-size: 12px;
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
        .points-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .point-item {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            font-family: monospace;
            font-size: 12px;
        }
        .point-item:last-child {
            border-bottom: none;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #27ae60;
            background: #f0f9f0;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Qdrant Vector Database Explorer</h1>
            <p>Explore your vector collections and perform similarity searches</p>
        </div>
        
        <div class="content">
            <!-- Collections Section -->
            <div class="section">
                <h3>üìö Collections</h3>
                <div id="collections-loading" class="loading">Loading collections...</div>
                <div id="collections-error" class="error" style="display: none;"></div>
                <div id="collections-list" class="collection-list"></div>
            </div>
            
            <!-- Collection Details Section -->
            <div id="collection-details" class="section" style="display: none;">
                <h3 id="collection-title">Collection Details</h3>
                <div id="collection-info"></div>
                
                <!-- Search Section -->
                <div class="search-section">
                    <h4>üîç Vector Search</h4>
                    <div class="search-controls">
                        <button onclick="generateRandomVector()">Generate Random Vector</button>
                        <input type="number" id="search-limit" value="10" min="1" max="100" placeholder="Limit">
                        <button onclick="performSearch()">Search</button>
                    </div>
                    <div id="search-results" class="search-results"></div>
                </div>
                
                <!-- Points Browser -->
                <div style="margin-top: 20px;">
                    <h4>üìÑ Browse Points</h4>
                    <div class="search-controls">
                        <input type="number" id="points-limit" value="20" min="1" max="100" placeholder="Limit">
                        <button onclick="loadPoints()">Load Points</button>
                    </div>
                    <div id="points-list" class="points-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCollection = null;
        let currentVector = null;

        // Load collections on page load
        window.onload = function() {
            loadCollections();
        };

        async function loadCollections() {
            try {
                const response = await fetch('/api/collections');
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayCollections(data.collections);
                } else {
                    showError('collections-error', data.message);
                }
            } catch (error) {
                showError('collections-error', 'Failed to load collections: ' + error.message);
            }
        }

        function displayCollections(collections) {
            const container = document.getElementById('collections-list');
            const loading = document.getElementById('collections-loading');
            
            loading.style.display = 'none';
            
            if (collections.length === 0) {
                container.innerHTML = '<div class="error">No collections found</div>';
                return;
            }
            
            container.innerHTML = collections.map(collection => `
                <div class="collection-card" onclick="selectCollection('${collection.name}')">
                    <div class="collection-name">${collection.name}</div>
                    <div class="collection-info">Click to explore</div>
                </div>
            `).join('');
        }

        async function selectCollection(collectionName) {
            currentCollection = collectionName;
            
            // Update UI
            document.querySelectorAll('.collection-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.collection-card').classList.add('selected');
            
            // Show collection details
            document.getElementById('collection-details').style.display = 'block';
            document.getElementById('collection-title').textContent = `Collection: ${collectionName}`;
            
            // Load collection info
            await loadCollectionInfo(collectionName);
            
            // Show search section
            document.querySelector('.search-section').classList.add('active');
        }

        async function loadCollectionInfo(collectionName) {
            try {
                const response = await fetch(`/api/collection/${collectionName}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    const info = data.info;
                    document.getElementById('collection-info').innerHTML = `
                        <div class="success">
                            <strong>Points:</strong> ${info.points_count.toLocaleString()}<br>
                            <strong>Vector Size:</strong> ${info.vector_size}<br>
                            <strong>Distance Metric:</strong> ${info.distance}<br>
                            <strong>Indexed Vectors:</strong> ${info.indexed_vectors.toLocaleString()}
                        </div>
                    `;
                } else {
                    showError('collection-info', data.message);
                }
            } catch (error) {
                showError('collection-info', 'Failed to load collection info: ' + error.message);
            }
        }

        async function generateRandomVector() {
            if (!currentCollection) return;
            
            try {
                const response = await fetch(`/api/collection/${currentCollection}/random_vector`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    currentVector = data.vector;
                    showSuccess('search-results', `Generated random vector with ${data.vector.length} dimensions`);
                } else {
                    showError('search-results', data.message);
                }
            } catch (error) {
                showError('search-results', 'Failed to generate vector: ' + error.message);
            }
        }

        async function performSearch() {
            if (!currentCollection || !currentVector) {
                showError('search-results', 'Please generate a random vector first');
                return;
            }
            
            const limit = document.getElementById('search-limit').value;
            
            try {
                const response = await fetch(`/api/collection/${currentCollection}/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        vector: currentVector,
                        limit: parseInt(limit)
                    })
                });
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    displaySearchResults(data.results);
                } else {
                    showError('search-results', data.message);
                }
            } catch (error) {
                showError('search-results', 'Search failed: ' + error.message);
            }
        }

        function displaySearchResults(results) {
            const container = document.getElementById('search-results');
            
            if (results.length === 0) {
                container.innerHTML = '<div class="error">No results found</div>';
                return;
            }
            
            container.innerHTML = results.map(result => `
                <div class="result-item">
                    <div class="result-score">Score: ${result.score.toFixed(4)}</div>
                    <div class="result-payload">${JSON.stringify(result.payload, null, 2)}</div>
                </div>
            `).join('');
        }

        async function loadPoints() {
            if (!currentCollection) return;
            
            const limit = document.getElementById('points-limit').value;
            
            try {
                const response = await fetch(`/api/collection/${currentCollection}/points?limit=${limit}`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayPoints(data.points);
                } else {
                    showError('points-list', data.message);
                }
            } catch (error) {
                showError('points-list', 'Failed to load points: ' + error.message);
            }
        }

        function displayPoints(points) {
            const container = document.getElementById('points-list');
            
            if (points.length === 0) {
                container.innerHTML = '<div class="error">No points found</div>';
                return;
            }
            
            container.innerHTML = points.map(point => `
                <div class="point-item">
                    <strong>ID:</strong> ${point.id}<br>
                    <strong>Payload:</strong> ${JSON.stringify(point.payload, null, 2)}
                </div>
            `).join('');
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="error">${message}</div>`;
        }

        function showSuccess(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="success">${message}</div>`;
        }
    </script>
</body>
</html>
